---
phase: 03-type-generation-and-first-resource
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/generated/types.ts
  - openapi.json
autonomous: true

must_haves:
  truths:
    - "Types are auto-generated from OpenAPI spec"
    - "Generated types include agent response schemas"
    - "npm run generate:types produces types.ts"
  artifacts:
    - path: "src/generated/types.ts"
      provides: "OpenAPI-generated TypeScript types"
      contains: "AgentResponse"
    - path: "package.json"
      provides: "Type generation script"
      contains: "generate:types"
    - path: "openapi.json"
      provides: "OpenAPI spec file (committed to repo)"
      contains: "AgentResponse"
  key_links:
    - from: "package.json"
      to: "openapi-typescript"
      via: "devDependencies"
      pattern: "openapi-typescript"
---

<objective>
Set up OpenAPI-to-TypeScript type generation pipeline using openapi-typescript.

Purpose: Establish automated type generation from the AgentOS OpenAPI spec so all API types are derived from the source of truth rather than manually maintained.

Output: Generated types file at src/generated/types.ts containing all API schemas (93 schemas including AgentResponse, error responses, etc.)
</objective>

<execution_context>
@/Users/adamshedivy/.claude/get-shit-done/workflows/execute-plan.md
@/Users/adamshedivy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-type-generation-and-first-resource/03-CONTEXT.md

# Existing codebase
@src/types.ts
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install openapi-typescript and add generation script</name>
  <files>package.json</files>
  <action>
Install openapi-typescript as a dev dependency:
```bash
npm install --save-dev openapi-typescript
```

Add a "generate:types" script to package.json scripts:
```json
"generate:types": "openapi-typescript ./openapi.json -o src/generated/types.ts"
```

The script uses the openapi.json file committed to the repo root. This ensures:
- Type generation doesn't require a running AgentOS instance
- CI/CD works without server dependencies
- The spec version is tracked with the code

To update the spec when the API changes:
```bash
curl -s http://localhost:7777/openapi.json > openapi.json
git add openapi.json
git commit -m "chore: update OpenAPI spec"
```
  </action>
  <verify>
- `npm run generate:types --help` shows openapi-typescript options
- package.json contains "generate:types" script
- package.json devDependencies includes "openapi-typescript"
  </verify>
  <done>openapi-typescript installed and generate:types script configured in package.json</done>
</task>

<task type="auto">
  <name>Task 2: Generate types from OpenAPI spec</name>
  <files>src/generated/types.ts</files>
  <action>
Verify the OpenAPI spec exists in the repo:
```bash
ls -lh openapi.json
```

The openapi.json file should be present in the repo root (committed in this phase).

Create the src/generated directory if it doesn't exist:
```bash
mkdir -p src/generated
```

Run the type generation script:
```bash
npm run generate:types
```

This will create src/generated/types.ts with all 93 schemas from the OpenAPI spec including:
- AgentResponse (agent details)
- Body_create_agent_run (run request parameters)
- Error response schemas (BadRequestResponse, UnauthenticatedResponse, etc.)

After generation, verify the file contains expected types by checking for key schema names.

Add a comment header to the generated file explaining it's auto-generated:
The openapi-typescript tool adds its own header, so no manual modification needed.

Commit the generated types to git (per CONTEXT.md decision: types committed to git).
  </action>
  <verify>
- openapi.json exists in repo root
- src/generated/types.ts exists
- File contains "AgentResponse" type
- File contains "Body_create_agent_run" type
- File contains error response types
- `npm run typecheck` passes
  </verify>
  <done>Types generated from OpenAPI spec, file committed to git, typecheck passes</done>
</task>

<task type="auto">
  <name>Task 3: Create tests for type generation</name>
  <files>tests/generated.test.ts</files>
  <action>
Create a test file that verifies the generated types are importable and have expected shape.

Tests should verify:
1. Types can be imported from src/generated/types.ts
2. AgentResponse type exists and has expected properties (id, name, model)
3. Body_create_agent_run type exists with message field
4. Error response types exist

This is a compile-time check rather than runtime - the tests just verify TypeScript doesn't complain about the imports and type usage.

Example test structure:
```typescript
import { describe, it, expect } from 'vitest';
import type { components, paths } from '../src/generated/types';

describe('Generated Types', () => {
  it('exports components schemas', () => {
    // Type-level assertions - if this compiles, types are valid
    type AgentResponse = components['schemas']['AgentResponse'];
    type RunRequest = components['schemas']['Body_create_agent_run'];

    // Runtime check that types namespace exists
    expect(true).toBe(true);
  });

  it('AgentResponse has expected properties', () => {
    // Type assertion for shape
    const mockAgent: components['schemas']['AgentResponse'] = {
      id: 'test-agent',
      name: 'Test Agent',
    };
    expect(mockAgent.id).toBe('test-agent');
  });
});
```
  </action>
  <verify>
- tests/generated.test.ts exists
- `npm test` passes including new tests
- Types are correctly importable in test file
  </verify>
  <done>Generated types verified via test file, all tests pass</done>
</task>

</tasks>

<verification>
1. `npm run generate:types` completes successfully
2. src/generated/types.ts contains AgentResponse, Body_create_agent_run, error types
3. `npm run typecheck` passes
4. `npm test` passes with new generated types tests
5. `npm run lint` passes
</verification>

<success_criteria>
- openapi-typescript installed as dev dependency
- generate:types script in package.json
- src/generated/types.ts exists with all OpenAPI schemas
- Generated types are importable and type-check correctly
- Tests verify type structure
</success_criteria>

<output>
After completion, create `.planning/phases/03-type-generation-and-first-resource/03-01-SUMMARY.md`
</output>
