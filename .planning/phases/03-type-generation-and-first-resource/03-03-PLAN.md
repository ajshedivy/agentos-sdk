---
phase: 03-type-generation-and-first-resource
plan: 03
type: execute
wave: 3
depends_on: ["03-02"]
files_modified:
  - src/client.ts
  - src/index.ts
  - tests/client.test.ts
  - tests/index.test.ts
autonomous: true

must_haves:
  truths:
    - "Client class exposes agents namespace with resource methods"
    - "User can call client.agents.list() to list agents"
    - "User can call client.agents.get(id) to get agent details"
    - "User can call client.agents.run(id, options) to run agent"
  artifacts:
    - path: "src/client.ts"
      provides: "AgentOSClient with agents property"
      contains: "this.agents = new AgentsResource"
    - path: "src/index.ts"
      provides: "Exports for agents resource and types"
      exports: ["AgentsResource"]
  key_links:
    - from: "src/client.ts"
      to: "src/resources/agents.ts"
      via: "import and instantiation"
      pattern: "import.*AgentsResource"
    - from: "src/client.ts"
      to: "this.agents"
      via: "readonly property"
      pattern: "readonly agents: AgentsResource"
---

<objective>
Integrate AgentsResource into AgentOSClient and export via index.ts.

Purpose: Enable the intended SDK usage pattern where users access agents via `client.agents.list()` rather than importing AgentsResource directly.

Output: AgentOSClient class with `agents` property exposing list, get, run methods; complete public exports.
</objective>

<execution_context>
@/Users/adamshedivy/.claude/get-shit-done/workflows/execute-plan.md
@/Users/adamshedivy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-type-generation-and-first-resource/03-CONTEXT.md
@.planning/phases/03-type-generation-and-first-resource/03-01-SUMMARY.md
@.planning/phases/03-type-generation-and-first-resource/03-02-SUMMARY.md

# Existing code to modify
@src/client.ts
@src/index.ts
@src/resources/agents.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add agents property to AgentOSClient</name>
  <files>src/client.ts</files>
  <action>
Modify AgentOSClient to include an `agents` property that exposes AgentsResource methods.

Changes to src/client.ts:

1. Import AgentsResource:
```typescript
import { AgentsResource } from './resources/agents';
```

2. Add readonly agents property to the class:
```typescript
readonly agents: AgentsResource;
```

3. In constructor, instantiate AgentsResource with client config:
```typescript
this.agents = new AgentsResource({
  baseUrl: this.baseUrl,
  headers: this.buildHeaders(),
  timeout: this.timeout,
  maxRetries: this.maxRetries,
});
```

The AgentsResource receives the same configuration that the client uses internally. Headers include the Authorization header if apiKey is set.

Note: The buildHeaders() method is already private. We can call it in the constructor to get the full headers including auth. Alternatively, we could pass the client instance itself, but the config approach is cleaner and avoids circular dependencies.

Full updated class structure:
```typescript
import { requestWithRetry } from "./http";
import { AgentsResource } from "./resources/agents";
import type {
  AgentOSClientOptions,
  HealthStatus,
  OSConfig,
  RequestOptions,
} from "./types";

export class AgentOSClient {
  readonly version = "0.1.0";
  readonly agents: AgentsResource;

  private readonly baseUrl: string;
  private readonly apiKey?: string;
  private readonly timeout: number;
  private readonly maxRetries: number;
  private readonly defaultHeaders: Record<string, string>;

  constructor(options: AgentOSClientOptions) {
    if (!options.baseUrl) {
      throw new Error("baseUrl is required");
    }

    this.baseUrl = options.baseUrl.replace(/\/$/, "");
    this.apiKey = options.apiKey;
    this.timeout = options.timeout ?? 30000;
    this.maxRetries = options.maxRetries ?? 2;
    this.defaultHeaders = {
      "Content-Type": "application/json",
      "User-Agent": `agentos-sdk/${this.version}`,
      ...options.headers,
    };

    // Initialize resource namespaces
    this.agents = new AgentsResource({
      baseUrl: this.baseUrl,
      headers: this.buildHeaders(),
      timeout: this.timeout,
      maxRetries: this.maxRetries,
    });
  }

  // ... existing methods unchanged
}
```
  </action>
  <verify>
- src/client.ts imports AgentsResource
- AgentOSClient has readonly `agents` property
- Constructor initializes agents with config
- `npm run typecheck` passes
  </verify>
  <done>AgentOSClient has agents property providing access to AgentsResource methods</done>
</task>

<task type="auto">
  <name>Task 2: Update index.ts exports</name>
  <files>src/index.ts</files>
  <action>
Update src/index.ts to export:
1. AgentsResource class (for advanced users who want to instantiate directly)
2. Generated types (for type annotations)
3. RunOptions type from agents resource

Add these exports to the existing index.ts:

```typescript
// Resource classes
export { AgentsResource } from './resources/agents';
export type { AgentsResourceConfig, RunOptions } from './resources/agents';

// Generated types (re-export useful types)
export type { components, paths } from './generated/types';
```

Keep all existing exports (AgentOSClient, errors, types, VERSION).

The final index.ts should export:
- AgentOSClient (main entry point)
- AgentsResource (for direct use if needed)
- Error classes (APIError, BadRequestError, etc.)
- Configuration types (AgentOSClientOptions, RequestOptions)
- Generated types namespace (components, paths)
- VERSION constant
  </action>
  <verify>
- src/index.ts exports AgentsResource
- src/index.ts exports generated types
- `npm run typecheck` passes
- `npm run build` succeeds
  </verify>
  <done>All public APIs exported from index.ts including AgentsResource and generated types</done>
</task>

<task type="auto">
  <name>Task 3: Update tests for client integration</name>
  <files>tests/client.test.ts, tests/index.test.ts</files>
  <action>
Update existing test files to cover the new agents property.

In tests/client.test.ts, add tests:
```typescript
describe('agents property', () => {
  it('exposes AgentsResource instance', () => {
    const client = new AgentOSClient({ baseUrl: 'https://api.example.com' });
    expect(client.agents).toBeDefined();
    expect(typeof client.agents.list).toBe('function');
    expect(typeof client.agents.get).toBe('function');
    expect(typeof client.agents.run).toBe('function');
  });

  it('passes client config to agents resource', async () => {
    const fetchSpy = vi.spyOn(globalThis, 'fetch').mockResolvedValueOnce(
      new Response(JSON.stringify([]), { status: 200 })
    );

    const client = new AgentOSClient({
      baseUrl: 'https://api.example.com',
      apiKey: 'test-key',
    });

    await client.agents.list();

    expect(fetchSpy).toHaveBeenCalledWith(
      'https://api.example.com/agents',
      expect.objectContaining({
        headers: expect.objectContaining({
          Authorization: 'Bearer test-key',
        }),
      })
    );

    fetchSpy.mockRestore();
  });
});
```

In tests/index.test.ts, add export verification:
```typescript
it('exports AgentsResource', () => {
  expect(AgentsResource).toBeDefined();
  expect(typeof AgentsResource).toBe('function');
});

it('exports generated types namespace', () => {
  // Type-level check - if this compiles, exports work
  // Runtime: just verify the import doesn't throw
  expect(true).toBe(true);
});
```

Update imports in test files to include new exports.
  </action>
  <verify>
- tests/client.test.ts has agents property tests
- tests/index.test.ts verifies AgentsResource export
- `npm test` passes
- All existing tests still pass
  </verify>
  <done>Client and index tests updated to cover agents integration</done>
</task>

</tasks>

<verification>
1. client.agents property exists and is AgentsResource instance
2. client.agents.list(), get(), run() methods work
3. AgentsResource exported from index.ts
4. Generated types exported from index.ts
5. `npm run typecheck` passes
6. `npm test` passes
7. `npm run build` succeeds
8. `npm run lint` passes
</verification>

<success_criteria>
- AgentOSClient has `agents` property
- Users can call client.agents.list(), client.agents.get(id), client.agents.run(id, opts)
- Agents resource receives proper auth headers from client
- All types and classes properly exported
- Full test coverage for integration
</success_criteria>

<output>
After completion, create `.planning/phases/03-type-generation-and-first-resource/03-03-SUMMARY.md`
</output>
