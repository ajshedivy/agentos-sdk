---
phase: 05-resource-expansion
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/resources/sessions.ts
  - tests/resources/sessions.test.ts
autonomous: true

must_haves:
  truths:
    - "User can list sessions with filtering/pagination via client.sessions.list(options)"
    - "User can get session details via client.sessions.get(sessionId)"
    - "User can create session via client.sessions.create(options)"
    - "User can rename session via client.sessions.rename(sessionId, name)"
    - "User can delete session via client.sessions.delete(sessionId)"
    - "User can get runs for session via client.sessions.getRuns(sessionId)"
  artifacts:
    - path: "src/resources/sessions.ts"
      provides: "SessionsResource class with list, get, create, rename, delete, getRuns methods"
      exports: ["SessionsResource", "ListSessionsOptions", "CreateSessionOptions"]
    - path: "tests/resources/sessions.test.ts"
      provides: "Tests for SessionsResource"
      min_lines: 180
  key_links:
    - from: "src/resources/sessions.ts"
      to: "src/client.ts"
      via: "receives AgentOSClient instance in constructor"
      pattern: "constructor.*AgentOSClient"
    - from: "src/resources/sessions.ts"
      to: "src/generated/types.ts"
      via: "uses SessionSchema and SessionType types"
      pattern: 'components\\["schemas"\\]\\["Session'
---

<objective>
Create SessionsResource class with CRUD operations and pagination/filtering support.

Purpose: Enable session management with filtering and pagination following URLSearchParams patterns from research.
Output: SessionsResource class with full test coverage, ready for client integration.
</objective>

<execution_context>
@/Users/adamshedivy/.claude/get-shit-done/workflows/execute-plan.md
@/Users/adamshedivy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-resource-expansion/05-RESEARCH.md

# Reference for pattern
@src/resources/agents.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SessionsResource class</name>
  <files>src/resources/sessions.ts</files>
  <action>
Create SessionsResource class with CRUD + pagination/filtering:

1. Import types from generated types:
   - SessionSchema as response type: components["schemas"]["SessionSchema"]
   - PaginatedResponse_SessionSchema_ for list response: components["schemas"]["PaginatedResponse_SessionSchema_"]

2. Define option interfaces:

```typescript
export interface ListSessionsOptions {
  type?: string;  // 'agent' | 'team' | 'workflow'
  componentId?: string;
  userId?: string;
  name?: string;
  page?: number;
  limit?: number;
  sortBy?: string;
  sortOrder?: 'asc' | 'desc';
}

export interface CreateSessionOptions {
  type: string;  // 'agent' | 'team' | 'workflow'
  componentId: string;
  name?: string;
  userId?: string;
  dbId?: string;
}
```

3. Implement methods using URLSearchParams for query parameters:

- list(options?: ListSessionsOptions): Promise - GET /sessions with query params
  - Build URLSearchParams, only append defined values
  - Map: type, componentId -> component_id, userId -> user_id, name, page, limit, sortBy -> sort_by, sortOrder -> sort_order

- get(sessionId: string, options?: { dbId?: string }): Promise - GET /sessions/{sessionId}
  - Optional db_id query param

- create(options: CreateSessionOptions): Promise - POST /sessions
  - Use FormData for body: type, component_id, name (optional), user_id (optional), db_id (optional)

- rename(sessionId: string, name: string): Promise<void> - POST /sessions/{sessionId}/rename
  - Use FormData with name field

- delete(sessionId: string, options?: { dbId?: string }): Promise<void> - DELETE /sessions/{sessionId}
  - Optional db_id query param

- getRuns(sessionId: string): Promise<unknown[]> - GET /sessions/{sessionId}/runs

All path parameters must use encodeURIComponent().
Use URLSearchParams pattern from research: only append defined values, build path with query string.
  </action>
  <verify>
File exists and TypeScript compiles: `npm run build`
  </verify>
  <done>
SessionsResource class created with list (pagination), get, create, rename, delete, getRuns methods.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create SessionsResource tests</name>
  <files>tests/resources/sessions.test.ts</files>
  <action>
Create comprehensive tests for SessionsResource:

Test structure following agents.test.ts pattern:
- Set up mockClient, requestSpy in beforeEach
- Clean up in afterEach

Test coverage:

list():
- Calls GET /sessions with no params when options empty
- Adds query params for type, component_id, user_id, name
- Adds pagination params page, limit
- Adds sort params sort_by, sort_order
- Only includes defined params (no undefined=undefined in query)
- Handles empty array response

get():
- Returns session by ID with correct path
- URL-encodes sessionId (test with /, space, @)
- Adds db_id query param when provided
- Propagates errors

create():
- Sends POST /sessions with FormData
- Includes type and component_id in FormData
- Includes optional name, user_id, db_id when provided
- Does not include optional fields when undefined

rename():
- Sends POST /sessions/{id}/rename with FormData
- FormData contains name field
- URL-encodes sessionId

delete():
- Sends DELETE /sessions/{id}
- Adds db_id query param when provided
- URL-encodes sessionId

getRuns():
- Calls GET /sessions/{id}/runs
- URL-encodes sessionId
- Returns array
  </action>
  <verify>
Tests pass: `npm test -- tests/resources/sessions.test.ts`
  </verify>
  <done>
All SessionsResource tests pass, verifying query parameter construction and FormData handling.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` - TypeScript compiles without errors
2. `npm test -- tests/resources/sessions.test.ts` - All tests pass
3. Verify URLSearchParams usage handles undefined values correctly
</verification>

<success_criteria>
- SessionsResource class exists with list, get, create, rename, delete, getRuns methods
- list() supports all filter/pagination options via URLSearchParams
- create() uses FormData for POST body
- All tests pass (~25+ tests)
- TypeScript compiles with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-resource-expansion/05-03-SUMMARY.md`
</output>
