---
phase: 05-resource-expansion
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/resources/workflows.ts
  - tests/resources/workflows.test.ts
autonomous: true

must_haves:
  truths:
    - "User can list all workflows via client.workflows.list()"
    - "User can get workflow details via client.workflows.get(workflowId)"
    - "User can run workflow (non-streaming) via client.workflows.run(workflowId, options)"
    - "User can run workflow (streaming) via client.workflows.runStream(workflowId, options)"
    - "User can cancel workflow run via client.workflows.cancel(workflowId, runId)"
  artifacts:
    - path: "src/resources/workflows.ts"
      provides: "WorkflowsResource class with list, get, run, runStream, continue, cancel methods"
      exports: ["WorkflowsResource", "WorkflowRunOptions", "WorkflowStreamRunOptions", "WorkflowContinueOptions"]
    - path: "tests/resources/workflows.test.ts"
      provides: "Tests for WorkflowsResource"
      min_lines: 200
  key_links:
    - from: "src/resources/workflows.ts"
      to: "src/client.ts"
      via: "receives AgentOSClient instance in constructor"
      pattern: "constructor.*AgentOSClient"
    - from: "src/resources/workflows.ts"
      to: "src/streaming/stream.ts"
      via: "returns AgentStream from runStream/continue"
      pattern: "AgentStream\\.fromSSEResponse"
---

<objective>
Create WorkflowsResource class that mirrors AgentsResource exactly.

Purpose: Enable running workflows with streaming support following the established AgentsResource pattern.
Output: WorkflowsResource class with full test coverage, ready for client integration.
</objective>

<execution_context>
@/Users/adamshedivy/.claude/get-shit-done/workflows/execute-plan.md
@/Users/adamshedivy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-resource-expansion/05-RESEARCH.md

# Reference for pattern
@src/resources/agents.ts
@tests/resources/agents.test.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WorkflowsResource class</name>
  <files>src/resources/workflows.ts</files>
  <action>
Create WorkflowsResource class that mirrors AgentsResource exactly:

1. Copy structure from src/resources/agents.ts
2. Replace all "agents" with "workflows" in paths
3. Replace "AgentsResource" with "WorkflowsResource"
4. Replace "AgentResponse" with "WorkflowResponse" from generated types
5. Rename option interfaces: RunOptions -> WorkflowRunOptions, StreamRunOptions -> WorkflowStreamRunOptions, ContinueOptions -> WorkflowContinueOptions (avoid naming conflicts)

Methods to implement (all identical to AgentsResource):
- list(): Promise<WorkflowResponse[]> - GET /workflows
- get(workflowId: string): Promise<WorkflowResponse> - GET /workflows/{workflowId}
- run(workflowId: string, options: WorkflowRunOptions): Promise<unknown> - POST /workflows/{workflowId}/runs with FormData
- runStream(workflowId: string, options: WorkflowStreamRunOptions): Promise<AgentStream> - POST /workflows/{workflowId}/runs with stream=true
- continue(workflowId: string, runId: string, options: WorkflowContinueOptions): Promise<AgentStream | unknown> - POST /workflows/{workflowId}/runs/{runId}/continue
- cancel(workflowId: string, runId: string): Promise<void> - POST /workflows/{workflowId}/runs/{runId}/cancel

Use components["schemas"]["WorkflowResponse"] for return type.
All path parameters must use encodeURIComponent().
  </action>
  <verify>
File exists and TypeScript compiles: `npm run build`
  </verify>
  <done>
WorkflowsResource class created with all methods, types imported correctly, paths use /workflows.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create WorkflowsResource tests</name>
  <files>tests/resources/workflows.test.ts</files>
  <action>
Create comprehensive tests for WorkflowsResource mirroring tests/resources/agents.test.ts:

1. Copy test structure from agents.test.ts
2. Replace all references to AgentsResource with WorkflowsResource
3. Update import path to "../../src/resources/workflows"
4. Verify all path assertions use "/workflows" not "/agents"

Test coverage to include:
- list() - returns array, propagates errors, handles empty array
- get() - returns workflow by ID, URL-encodes special characters (/, space, @), handles empty string ID
- run() - FormData with message/stream=false, includes session_id/user_id when provided, URL-encodes workflowId
- runStream() - returns AgentStream, builds FormData with stream=true, passes AbortController
- continue() - returns AgentStream when streaming (default), returns result when stream=false, includes tools/session_id/user_id
- cancel() - calls correct endpoint, URL-encodes IDs

Critical path verification in each test: ensure endpoint uses "/workflows" not "/agents"
  </action>
  <verify>
Tests pass: `npm test -- tests/resources/workflows.test.ts`
  </verify>
  <done>
All WorkflowsResource tests pass, verifying correct /workflows paths and FormData construction.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` - TypeScript compiles without errors
2. `npm test -- tests/resources/workflows.test.ts` - All tests pass
3. `grep -r "/agents" src/resources/workflows.ts` - Returns no matches (no accidental /agents paths)
</verification>

<success_criteria>
- WorkflowsResource class exists with list, get, run, runStream, continue, cancel methods
- All methods use /workflows paths (not /agents)
- All tests pass (~30+ tests mirroring agents.test.ts)
- TypeScript compiles with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-resource-expansion/05-02-SUMMARY.md`
</output>
