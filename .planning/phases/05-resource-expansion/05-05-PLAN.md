---
phase: 05-resource-expansion
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - src/resources/traces.ts
  - src/resources/metrics.ts
  - tests/resources/traces.test.ts
  - tests/resources/metrics.test.ts
autonomous: true

must_haves:
  truths:
    - "User can list traces with filtering via client.traces.list(options)"
    - "User can get trace details via client.traces.get(traceId)"
    - "User can get metrics via client.metrics.get(options)"
    - "User can refresh metrics via client.metrics.refresh()"
  artifacts:
    - path: "src/resources/traces.ts"
      provides: "TracesResource class with list, get methods"
      exports: ["TracesResource", "ListTracesOptions"]
    - path: "src/resources/metrics.ts"
      provides: "MetricsResource class with get, refresh methods"
      exports: ["MetricsResource", "GetMetricsOptions"]
    - path: "tests/resources/traces.test.ts"
      provides: "Tests for TracesResource"
      min_lines: 80
    - path: "tests/resources/metrics.test.ts"
      provides: "Tests for MetricsResource"
      min_lines: 50
  key_links:
    - from: "src/resources/traces.ts"
      to: "src/generated/types.ts"
      via: "uses TraceSummary and TraceDetail types"
      pattern: 'components\\["schemas"\\]\\["Trace'
    - from: "src/resources/metrics.ts"
      to: "src/generated/types.ts"
      via: "uses MetricsResponse type"
      pattern: 'components\\["schemas"\\]\\["MetricsResponse"\\]'
---

<objective>
Create TracesResource and MetricsResource classes for read-only observability data.

Purpose: Enable trace retrieval and metrics access for monitoring and debugging.
Output: Two read-only resource classes with full test coverage, ready for client integration.
</objective>

<execution_context>
@/Users/adamshedivy/.claude/get-shit-done/workflows/execute-plan.md
@/Users/adamshedivy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-resource-expansion/05-RESEARCH.md

# Reference for pattern
@src/resources/agents.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TracesResource class</name>
  <files>src/resources/traces.ts</files>
  <action>
Create TracesResource class for read-only trace access:

1. Import types from generated types:
   - TraceSummary for list: components["schemas"]["TraceSummary"]
   - TraceDetail for get: components["schemas"]["TraceDetail"]
   - PaginatedResponse_TraceSummary_ for list response: components["schemas"]["PaginatedResponse_TraceSummary_"]

2. Define option interface:

```typescript
export interface ListTracesOptions {
  runId?: string;
  sessionId?: string;
  userId?: string;
  agentId?: string;
  status?: string;
  page?: number;
  limit?: number;
}
```

3. Implement methods:

- list(options?: ListTracesOptions): Promise - GET /traces with query params
  - Build URLSearchParams: run_id, session_id, user_id, agent_id, status, page, limit
  - Only append defined values

- get(traceId: string): Promise - GET /traces/{traceId}
  - Return TraceDetail type
  - Use encodeURIComponent() for traceId

Note: TracesResource is read-only (no create/update/delete operations).
  </action>
  <verify>
File exists and TypeScript compiles: `npm run build`
  </verify>
  <done>
TracesResource class created with list (filtering), get methods.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create MetricsResource class</name>
  <files>src/resources/metrics.ts</files>
  <action>
Create MetricsResource class for metrics access and refresh:

1. Import types from generated types:
   - MetricsResponse: components["schemas"]["MetricsResponse"]

2. Define option interface:

```typescript
export interface GetMetricsOptions {
  startingDate?: string;  // YYYY-MM-DD format
  endingDate?: string;    // YYYY-MM-DD format
}
```

3. Implement methods:

- get(options?: GetMetricsOptions): Promise - GET /metrics with query params
  - Build URLSearchParams: starting_date, ending_date
  - Only append defined values

- refresh(): Promise<void> - POST /metrics/refresh
  - No body, no query params
  - Returns void (endpoint returns 204 or empty)

Note: MetricsResource is read-only except for refresh trigger.
  </action>
  <verify>
File exists and TypeScript compiles: `npm run build`
  </verify>
  <done>
MetricsResource class created with get (date filtering), refresh methods.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create tests for TracesResource and MetricsResource</name>
  <files>tests/resources/traces.test.ts, tests/resources/metrics.test.ts</files>
  <action>
Create tests for both resources:

**tests/resources/traces.test.ts:**
- Set up mockClient, requestSpy pattern

list():
- Calls GET /traces with no params when options empty
- Adds query params for run_id, session_id, user_id, agent_id, status
- Adds pagination params page, limit
- Only includes defined params
- Handles empty array response

get():
- Returns trace by ID with correct path
- URL-encodes traceId (test with /, space, @)
- Propagates errors

**tests/resources/metrics.test.ts:**
- Set up mockClient, requestSpy pattern

get():
- Calls GET /metrics with no params when options empty
- Adds starting_date query param when provided
- Adds ending_date query param when provided
- Adds both params together
- Only includes defined params

refresh():
- Calls POST /metrics/refresh
- No body passed
- Returns void/undefined
- Propagates errors
  </action>
  <verify>
Tests pass: `npm test -- tests/resources/traces.test.ts tests/resources/metrics.test.ts`
  </verify>
  <done>
All TracesResource and MetricsResource tests pass, verifying query param handling and correct endpoints.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` - TypeScript compiles without errors
2. `npm test -- tests/resources/traces.test.ts` - TracesResource tests pass
3. `npm test -- tests/resources/metrics.test.ts` - MetricsResource tests pass
</verification>

<success_criteria>
- TracesResource class exists with list, get methods
- MetricsResource class exists with get, refresh methods
- All filter/date options supported via URLSearchParams
- All tests pass (~20+ tests total)
- TypeScript compiles with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-resource-expansion/05-05-SUMMARY.md`
</output>
