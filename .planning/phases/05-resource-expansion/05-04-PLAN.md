---
phase: 05-resource-expansion
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/resources/memories.ts
  - tests/resources/memories.test.ts
autonomous: true

must_haves:
  truths:
    - "User can list memories with filtering/pagination via client.memories.list(options)"
    - "User can get memory via client.memories.get(memoryId, options)"
    - "User can create memory via client.memories.create(options)"
    - "User can update memory via client.memories.update(memoryId, options)"
    - "User can delete memory via client.memories.delete(memoryId, options)"
  artifacts:
    - path: "src/resources/memories.ts"
      provides: "MemoriesResource class with list, get, create, update, delete methods"
      exports: ["MemoriesResource", "ListMemoriesOptions", "CreateMemoryOptions", "UpdateMemoryOptions"]
    - path: "tests/resources/memories.test.ts"
      provides: "Tests for MemoriesResource"
      min_lines: 180
  key_links:
    - from: "src/resources/memories.ts"
      to: "src/client.ts"
      via: "receives AgentOSClient instance in constructor"
      pattern: "constructor.*AgentOSClient"
    - from: "src/resources/memories.ts"
      to: "src/generated/types.ts"
      via: "uses UserMemorySchema type"
      pattern: 'components\\["schemas"\\]\\["UserMemorySchema"\\]'
---

<objective>
Create MemoriesResource class with full CRUD operations and filtering support.

Purpose: Enable memory management with filtering following URLSearchParams patterns.
Output: MemoriesResource class with full test coverage, ready for client integration.
</objective>

<execution_context>
@/Users/adamshedivy/.claude/get-shit-done/workflows/execute-plan.md
@/Users/adamshedivy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-resource-expansion/05-RESEARCH.md

# Reference for pattern
@src/resources/agents.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MemoriesResource class</name>
  <files>src/resources/memories.ts</files>
  <action>
Create MemoriesResource class with full CRUD + filtering:

1. Import types from generated types:
   - UserMemorySchema as response type: components["schemas"]["UserMemorySchema"]
   - PaginatedResponse_UserMemorySchema_ for list: components["schemas"]["PaginatedResponse_UserMemorySchema_"]

2. Define option interfaces:

```typescript
export interface ListMemoriesOptions {
  userId?: string;
  sessionId?: string;
  agentId?: string;
  page?: number;
  limit?: number;
  dbId?: string;
  table?: string;
}

export interface CreateMemoryOptions {
  content: string;
  userId?: string;
  topics?: string[];
  dbId?: string;
  table?: string;
}

export interface UpdateMemoryOptions {
  content?: string;
  topics?: string[];
  dbId?: string;
  table?: string;
}
```

3. Implement methods:

- list(options?: ListMemoriesOptions): Promise - GET /memories with query params
  - Build URLSearchParams: user_id, session_id, agent_id, page, limit, db_id, table
  - Only append defined values

- get(memoryId: string, options?: { dbId?: string; table?: string }): Promise - GET /memories/{memoryId}
  - Optional db_id, table query params

- create(options: CreateMemoryOptions): Promise - POST /memories
  - Query params: db_id, table (if provided)
  - JSON body: { content, user_id, topics }
  - Note: This endpoint uses JSON body, NOT FormData (per OpenAPI spec)

- update(memoryId: string, options: UpdateMemoryOptions): Promise - PUT /memories/{memoryId}
  - Query params: db_id, table (if provided)
  - JSON body: { content, topics }

- delete(memoryId: string, options?: { dbId?: string; table?: string }): Promise<void> - DELETE /memories/{memoryId}
  - Query params: db_id, table (if provided)

Important: Memory create/update use JSON body (application/json), not FormData.
Use JSON.stringify() for body, ensure client keeps Content-Type: application/json.
All path parameters must use encodeURIComponent().
  </action>
  <verify>
File exists and TypeScript compiles: `npm run build`
  </verify>
  <done>
MemoriesResource class created with list, get, create, update, delete methods using JSON body for create/update.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create MemoriesResource tests</name>
  <files>tests/resources/memories.test.ts</files>
  <action>
Create comprehensive tests for MemoriesResource:

Test structure following agents.test.ts pattern:
- Set up mockClient, requestSpy in beforeEach
- Clean up in afterEach

Test coverage:

list():
- Calls GET /memories with no params when options empty
- Adds query params for user_id, session_id, agent_id
- Adds pagination params page, limit
- Adds db_id, table params
- Only includes defined params
- Handles empty array response

get():
- Returns memory by ID with correct path
- URL-encodes memoryId (test with /, space, @)
- Adds db_id, table query params when provided
- Works without options parameter

create():
- Sends POST /memories with JSON body (not FormData)
- Body contains content field
- Includes user_id, topics when provided
- Adds db_id, table to query string
- Does not add query params when db_id/table undefined

update():
- Sends PUT /memories/{id} with JSON body
- Body can contain content and/or topics
- Adds db_id, table to query string when provided
- URL-encodes memoryId

delete():
- Sends DELETE /memories/{id}
- Adds db_id, table query params when provided
- URL-encodes memoryId
- Works without options parameter

Key verification: create() and update() use JSON body (string), not FormData
  </action>
  <verify>
Tests pass: `npm test -- tests/resources/memories.test.ts`
  </verify>
  <done>
All MemoriesResource tests pass, verifying JSON body for create/update and query param handling.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` - TypeScript compiles without errors
2. `npm test -- tests/resources/memories.test.ts` - All tests pass
3. Verify create/update use JSON.stringify(), not FormData
</verification>

<success_criteria>
- MemoriesResource class exists with list, get, create, update, delete methods
- list() supports filter options via URLSearchParams
- create()/update() use JSON body (not FormData)
- All tests pass (~25+ tests)
- TypeScript compiles with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-resource-expansion/05-04-SUMMARY.md`
</output>
